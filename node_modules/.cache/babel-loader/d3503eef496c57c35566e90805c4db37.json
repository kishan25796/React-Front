{"ast":null,"code":"import firebase from \"./firebase\";\nimport \"firebase/auth\";\nimport { Config } from \"./config/config\";\nexport const signInWithNumber = (number, recaptcha, setAuthFunction, setOtpScreen, setOpenLoading, setShowNumberError) => {\n  firebase.auth().signInWithPhoneNumber(number, recaptcha).then(function (e) {\n    setOpenLoading(false);\n    setAuthFunction(e);\n    setOtpScreen(true);\n  }).catch(function (error) {\n    setOpenLoading(false);\n    setShowNumberError(true);\n    return;\n  });\n};\nexport const handleClick = (values, setOtpScreen, setAuthFunction, setOpenLoading, setShowNumberError) => {\n  /* Re-Captcha verification is mandatory for firebase OTP authentication */\n  let recaptcha = new firebase.auth.RecaptchaVerifier(\"recaptcha-container\", {\n    size: \"invisible\"\n  });\n  let number = \"+91\" + values.number;\n\n  if (values.number === \"\") {\n    setOpenLoading(false);\n    setShowNumberError(true);\n    return;\n  }\n\n  signInWithNumber(number, recaptcha, setAuthFunction, setOtpScreen, setOpenLoading, setShowNumberError);\n};\nexport const handleOtpSubmit = (values, authFunction, history, setOpenLoading, setShowOTPError) => {\n  authFunction.confirm(values.code).then(function (result) {\n    const requestOptions = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        deviceType: \"WEB\",\n        userType: \"STUDENT\",\n        phone: values.number\n      })\n    };\n    fetch(`${Config.baseUrl}/user`, requestOptions).then(response => response.json()).then(data => {\n      localStorage.setItem(\"auth_token\", data.jwtToken);\n      localStorage.setItem(\"userId\", data.userId);\n      fetch(`${Config.baseUrl}/diff/user/${data.userId}`).then(response => response.json()).then(data => {\n        setOpenLoading(false);\n\n        if (data.userProperties.length === 0) {\n          document.location.href = \"/fullName\";\n        } else if (data.userProperties.filter(prop => prop.key === \"join_class_flow_complete\").length >= 1) {\n          document.location.href = \"/assignmentContainer\";\n        } else if (data.userProperties.filter(prop => prop.key === \"onboarding_flow_complete\").length >= 1) {\n          document.location.href = \"/joinClassContainer\";\n        } else {\n          document.location.href = \"/fullName\";\n        }\n      });\n    });\n  }).catch(function (error) {\n    setOpenLoading(false);\n    setShowOTPError(true);\n    return;\n  });\n};","map":{"version":3,"names":["firebase","Config","signInWithNumber","number","recaptcha","setAuthFunction","setOtpScreen","setOpenLoading","setShowNumberError","auth","signInWithPhoneNumber","then","e","catch","error","handleClick","values","RecaptchaVerifier","size","handleOtpSubmit","authFunction","history","setShowOTPError","confirm","code","result","requestOptions","method","headers","body","JSON","stringify","deviceType","userType","phone","fetch","baseUrl","response","json","data","localStorage","setItem","jwtToken","userId","userProperties","length","document","location","href","filter","prop","key"],"sources":["D:/studentapp/src/utils.js"],"sourcesContent":["import firebase from \"./firebase\";\nimport \"firebase/auth\";\nimport { Config } from \"./config/config\";\n\nexport const signInWithNumber = (\n\tnumber,\n\trecaptcha,\n\tsetAuthFunction,\n\tsetOtpScreen,\n\tsetOpenLoading,\n\tsetShowNumberError\n) => {\n\tfirebase\n\t\t.auth()\n\t\t.signInWithPhoneNumber(number, recaptcha)\n\t\t.then(function (e) {\n\t\t\tsetOpenLoading(false);\n\t\t\tsetAuthFunction(e);\n\t\t\tsetOtpScreen(true);\n\t\t})\n\t\t.catch(function (error) {\n\t\t\tsetOpenLoading(false);\n\t\t\tsetShowNumberError(true);\n\t\t\treturn;\n\t\t});\n};\n\nexport const handleClick = (\n\tvalues,\n\tsetOtpScreen,\n\tsetAuthFunction,\n\tsetOpenLoading,\n\tsetShowNumberError\n) => {\n\t/* Re-Captcha verification is mandatory for firebase OTP authentication */\n\n\tlet recaptcha = new firebase.auth.RecaptchaVerifier(\"recaptcha-container\", {\n\t\tsize: \"invisible\",\n\t});\n\n\tlet number = \"+91\" + values.number;\n\n\tif (values.number === \"\") {\n\t\tsetOpenLoading(false);\n\t\tsetShowNumberError(true);\n\t\treturn;\n\t}\n\tsignInWithNumber(\n\t\tnumber,\n\t\trecaptcha,\n\t\tsetAuthFunction,\n\t\tsetOtpScreen,\n\t\tsetOpenLoading,\n\t\tsetShowNumberError\n\t);\n};\n\nexport const handleOtpSubmit = (\n\tvalues,\n\tauthFunction,\n\thistory,\n\tsetOpenLoading,\n\tsetShowOTPError\n) => {\n\tauthFunction\n\t\t.confirm(values.code)\n\t\t.then(function (result) {\n\t\t\tconst requestOptions = {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tdeviceType: \"WEB\",\n\t\t\t\t\tuserType: \"STUDENT\",\n\t\t\t\t\tphone: values.number,\n\t\t\t\t}),\n\t\t\t};\n\t\t\tfetch(`${Config.baseUrl}/user`, requestOptions)\n\t\t\t\t.then((response) => response.json())\n\t\t\t\t.then((data) => {\n\t\t\t\t\tlocalStorage.setItem(\"auth_token\", data.jwtToken);\n\t\t\t\t\tlocalStorage.setItem(\"userId\", data.userId);\n\n\t\t\t\t\tfetch(`${Config.baseUrl}/diff/user/${data.userId}`)\n\t\t\t\t\t\t.then((response) => response.json())\n\t\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\t\tsetOpenLoading(false);\n\t\t\t\t\t\t\tif (data.userProperties.length === 0) {\n\t\t\t\t\t\t\t\tdocument.location.href = \"/fullName\";\n\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\tdata.userProperties.filter(\n\t\t\t\t\t\t\t\t\t(prop) => prop.key === \"join_class_flow_complete\"\n\t\t\t\t\t\t\t\t).length >= 1\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tdocument.location.href = \"/assignmentContainer\";\n\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\tdata.userProperties.filter(\n\t\t\t\t\t\t\t\t\t(prop) => prop.key === \"onboarding_flow_complete\"\n\t\t\t\t\t\t\t\t).length >= 1\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tdocument.location.href = \"/joinClassContainer\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdocument.location.href = \"/fullName\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t})\n\t\t.catch(function (error) {\n\t\t\tsetOpenLoading(false);\n\t\t\tsetShowOTPError(true);\n\t\t\treturn;\n\t\t});\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}